# çº¢åŒ…åˆçº¦éªŒè¯å·¥å…·

åŸºäº React + TypeScript + TailwindCSS + Zustand çš„çº¢åŒ…æ™ºèƒ½åˆçº¦éªŒè¯å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”— æ™ºèƒ½åˆçº¦éªŒè¯
- ğŸ’° åˆ›å»ºçº¢åŒ…
- ğŸ æŠ¢çº¢åŒ…
- ğŸ’¸ **é€€æ¬¾çº¢åŒ…** (é˜²æ­¢èµ„é‡‘é”å®š)
- ğŸ“Š äº‹ä»¶æ—¥å¿—æŸ¥è¯¢
- ğŸ” åˆçº¦åŠŸèƒ½æµ‹è¯•
- ğŸ‘› MetaMask é’±åŒ…é›†æˆ
- ğŸ›¡ï¸ **æ™ºèƒ½æ£€æµ‹è‡ªè½¬è´¦é˜²æŠ¤**
- ğŸ“‹ **æˆ‘çš„çº¢åŒ…ç®¡ç†**

## æŠ€æœ¯æ ˆ

- **React 18** - å‰ç«¯æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **TailwindCSS** - æ ·å¼æ¡†æ¶
- **Zustand** - çŠ¶æ€ç®¡ç†
- **Ethers.js** - Web3 äº¤äº’
- **Vite** - æ„å»ºå·¥å…·

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ common/        # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ contract/      # åˆçº¦ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ContractVerification.tsx    # åˆçº¦éªŒè¯
â”‚   â”‚   â”œâ”€â”€ FunctionTesting.tsx         # åŠŸèƒ½æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ RedPacketManager.tsx        # çº¢åŒ…ç®¡ç†
â”‚   â”‚   â””â”€â”€ EventQuery.tsx              # äº‹ä»¶æŸ¥è¯¢
â”‚   â””â”€â”€ wallet/        # é’±åŒ…ç›¸å…³ç»„ä»¶
â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰é’©å­
â”œâ”€â”€ store/             # Zustand çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ constants/         # å¸¸é‡å®šä¹‰
â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
```

## å¼€å§‹ä½¿ç”¨

### å®‰è£…ä¾èµ–

```bash
npm install
# æˆ–
yarn install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
# æˆ–
yarn dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
# æˆ–
yarn build
```

## ä½¿ç”¨æŒ‡å—

### 1. è¿æ¥é’±åŒ…
- ç¡®ä¿å®‰è£…äº† MetaMask å¹¶åˆ‡æ¢åˆ° Sepolia æµ‹è¯•ç½‘
- ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®è¿›è¡Œè¿æ¥

### 2. éªŒè¯åˆçº¦
- åœ¨åˆçº¦éªŒè¯åŒºåŸŸè¾“å…¥çº¢åŒ…åˆçº¦åœ°å€
- ç‚¹å‡»"éªŒè¯åˆçº¦"æŒ‰é’®æ£€æŸ¥åˆçº¦éƒ¨ç½²çŠ¶æ€

### 3. æµ‹è¯•åŠŸèƒ½

#### ğŸ”§ åŠŸèƒ½æµ‹è¯•åŒºåŸŸ
- **æµ‹è¯•è¯»å–åŠŸèƒ½**: éªŒè¯åˆçº¦çš„åªè¯»åŠŸèƒ½æ˜¯å¦æ­£å¸¸
- **åˆ›å»ºçº¢åŒ…**: è®¾ç½®çº¢åŒ…æ•°é‡å’Œæ€»é‡‘é¢åˆ›å»ºæ–°çº¢åŒ…
- **æŠ¢çº¢åŒ…**: è¾“å…¥çº¢åŒ…IDé¢†å–çº¢åŒ…ï¼ˆä¸èƒ½æŠ¢è‡ªå·±çš„çº¢åŒ…ï¼‰
- **é€€æ¬¾çº¢åŒ…**: é€€å›è‡ªå·±åˆ›å»ºçš„æœªå®Œæˆçº¢åŒ…çš„å‰©ä½™é‡‘é¢

#### ğŸ æˆ‘çš„çº¢åŒ…ç®¡ç†
- æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„æ‰€æœ‰çº¢åŒ…
- æ˜¾ç¤ºæ¯ä¸ªçº¢åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ€»é‡‘é¢ã€å‰©ä½™é‡‘é¢ã€æ•°é‡ç­‰ï¼‰
- ä¸€é”®é€€æ¬¾åŠŸèƒ½ï¼Œå¿«é€Ÿå–å›å‰©ä½™èµ„é‡‘
- çº¢åŒ…çŠ¶æ€å®æ—¶æ˜¾ç¤ºï¼ˆæ´»è·ƒ/å·²å®Œæˆï¼‰

#### ğŸ“Š äº‹ä»¶æ—¥å¿—æŸ¥è¯¢
- æŸ¥è¯¢åˆçº¦çš„æ‰€æœ‰å†å²äº‹ä»¶
- åŒ…æ‹¬åˆ›å»ºã€é¢†å–ã€é€€æ¬¾äº‹ä»¶çš„è¯¦ç»†è®°å½•

## ğŸ†• æ–°å¢åŠŸèƒ½äº®ç‚¹

### ğŸ’¸ æ™ºèƒ½é€€æ¬¾ç³»ç»Ÿ
- **é˜²æ­¢èµ„é‡‘é”å®š**: é¿å…å‰©ä½™çº¢åŒ…æ— äººé¢†å–å¯¼è‡´èµ„é‡‘æ°¸ä¹…é”å®š
- **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å¯é€€æ¬¾çš„çº¢åŒ…
- **æƒé™æ§åˆ¶**: åªæœ‰çº¢åŒ…åˆ›å»ºè€…å¯ä»¥é€€æ¬¾
- **çŠ¶æ€éªŒè¯**: æ£€æŸ¥çº¢åŒ…æ˜¯å¦è¿˜æœ‰å‰©ä½™é‡‘é¢

### ğŸ›¡ï¸ è‡ªè½¬è´¦é˜²æŠ¤
- **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯•å›¾é¢†å–è‡ªå·±åˆ›å»ºçš„çº¢åŒ…
- **å‹å¥½æç¤º**: æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **å¤šè´¦æˆ·æŒ‡å¯¼**: å¼•å¯¼ç”¨æˆ·ä½¿ç”¨ä¸åŒè´¦æˆ·è¿›è¡Œå®Œæ•´æµ‹è¯•

### ğŸ“‹ çº¢åŒ…ç®¡ç†é¢æ¿
- **å¯è§†åŒ–ç®¡ç†**: ç›´è§‚æ˜¾ç¤ºæ‰€æœ‰åˆ›å»ºçš„çº¢åŒ…
- **è¯¦ç»†ä¿¡æ¯**: å±•ç¤ºçº¢åŒ…çš„å®Œæ•´çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
- **å¿«é€Ÿæ“ä½œ**: ä¸€é”®é€€æ¬¾ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥çº¢åŒ…ID
- **å®æ—¶æ›´æ–°**: è‡ªåŠ¨åˆ·æ–°çº¢åŒ…çŠ¶æ€

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### å¤šè´¦æˆ·æµ‹è¯•
1. åœ¨ MetaMask ä¸­åˆ›å»ºå¤šä¸ªè´¦æˆ·
2. ç”¨è´¦æˆ·Aåˆ›å»ºçº¢åŒ…
3. åˆ‡æ¢åˆ°è´¦æˆ·Bæ¥æŠ¢çº¢åŒ…
4. ç”¨è´¦æˆ·Aé€€æ¬¾æœªå®Œæˆçš„çº¢åŒ…

### æœ€ä½³å®è·µ
- **åˆ›å»ºçº¢åŒ…å‰**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„æµ‹è¯•ETH
- **æŠ¢çº¢åŒ…æ—¶**: æ³¨æ„ä¸èƒ½æŠ¢è‡ªå·±åˆ›å»ºçš„çº¢åŒ…
- **é€€æ¬¾æ—¶æœº**: å»ºè®®åœ¨çº¢åŒ…åˆ›å»ºåä¸€æ®µæ—¶é—´å¦‚æ— äººé¢†å–å†é€€æ¬¾
- **Gasè´¹ç”¨**: é¢„ç•™è¶³å¤Ÿçš„ETHç”¨äºæ”¯ä»˜äº¤æ˜“è´¹ç”¨

## âš ï¸ é‡è¦æç¤º

1. **æµ‹è¯•ç¯å¢ƒ**: æœ¬å·¥å…·ä»…é€‚ç”¨äº Sepolia æµ‹è¯•ç½‘
2. **èµ„é‡‘å®‰å…¨**: è¯·å‹¿åœ¨ä¸»ç½‘ä½¿ç”¨æœªç»å……åˆ†æµ‹è¯•çš„åˆçº¦
3. **ç§é’¥ä¿æŠ¤**: å¦¥å–„ä¿ç®¡é’±åŒ…ç§é’¥ï¼Œä¸è¦åˆ†äº«ç»™ä»–äºº
4. **åˆçº¦éªŒè¯**: ä½¿ç”¨å‰è¯·ç¡®ä¿åˆçº¦åœ°å€æ­£ç¡®ä¸”å·²æ­£ç¡®éƒ¨ç½²

## ç¯å¢ƒè¦æ±‚

- Node.js >= 16
- MetaMask æµè§ˆå™¨æ’ä»¶
- Sepolia æµ‹è¯•ç½‘ ETH
- ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeç­‰ï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ— æ³•è¿æ¥é’±åŒ…**
A: ç¡®ä¿å·²å®‰è£…MetaMaskå¹¶è§£é”ï¼Œæ£€æŸ¥æ˜¯å¦åˆ‡æ¢åˆ°Sepoliaæµ‹è¯•ç½‘

**Q: äº¤æ˜“å¤±è´¥**
A: æ£€æŸ¥è´¦æˆ·ETHä½™é¢æ˜¯å¦è¶³å¤Ÿæ”¯ä»˜Gasè´¹ç”¨

**Q: ä¸èƒ½æŠ¢çº¢åŒ…**
A: æ£€æŸ¥æ˜¯å¦è¯•å›¾æŠ¢è‡ªå·±åˆ›å»ºçš„çº¢åŒ…ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒè´¦æˆ·

**Q: æ— æ³•é€€æ¬¾**
A: ç¡®ä¿æ˜¯çº¢åŒ…åˆ›å»ºè€…ä¸”çº¢åŒ…è¿˜æœ‰å‰©ä½™é‡‘é¢

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## æ›´æ–°æ—¥å¿—

### v1.1.0 (æœ€æ–°)
- âœ¨ æ–°å¢çº¢åŒ…é€€æ¬¾åŠŸèƒ½
- âœ¨ æ–°å¢çº¢åŒ…ç®¡ç†é¢æ¿
- ğŸ›¡ï¸ æ–°å¢è‡ªè½¬è´¦æ£€æµ‹é˜²æŠ¤
- ğŸ¨ æ”¹è¿›ç”¨æˆ·ç•Œé¢å’Œä½“éªŒ
- ğŸ“ ä¼˜åŒ–é”™è¯¯æç¤ºå’Œå¸®åŠ©æ–‡æ¡£

### v1.0.0
- ğŸ‰ åŸºç¡€åŠŸèƒ½å‘å¸ƒ
- ğŸ’° æ”¯æŒåˆ›å»ºå’ŒæŠ¢çº¢åŒ…
- ğŸ“Š æ”¯æŒäº‹ä»¶æŸ¥è¯¢
- ğŸ”— MetaMask é’±åŒ…é›†æˆ

## åˆçº¦éªŒè¯æµç¨‹

### å‰ç½®æ¡ä»¶
- å·²è¿æ¥é’±åŒ…ï¼ˆå»ºè®®ä½¿ç”¨ MetaMaskï¼‰ï¼Œå¹¶åˆ‡æ¢åˆ° `Sepolia` æµ‹è¯•ç½‘
- å·²éƒ¨ç½²å¹¶æ‹¿åˆ°çº¢åŒ…åˆçº¦åœ°å€

### éªŒè¯æ­¥éª¤ï¼ˆå‰ç«¯äº¤äº’ï¼‰
1. åœ¨é¡µé¢å·¦ä¾§/é¡¶éƒ¨å¯¼èˆªè¿›å…¥â€œåˆçº¦åŸºæœ¬ä¿¡æ¯â€æ¨¡å—ï¼ˆ`ContractVerification`ï¼‰
2. è¾“å…¥åˆçº¦åœ°å€ï¼ˆå½¢å¦‚ `0x...`ï¼‰ï¼Œç‚¹å‡»â€œéªŒè¯åˆçº¦â€
3. ç³»ç»Ÿå°†ä¾æ¬¡è¿›è¡Œä»¥ä¸‹æ ¡éªŒä¸åªè¯»è°ƒç”¨ï¼š
   - æ ¡éªŒå½“å‰ç½‘ç»œé“¾ ID æ˜¯å¦ä¸º `Sepolia`ï¼ˆ`chainId=11155111`ï¼‰
   - `provider.getCode(address)`ï¼šç¡®è®¤åœ°å€å­˜åœ¨åˆçº¦å­—èŠ‚ç 
   - `new ethers.Contract(address, CONTRACT_ABI, provider)`ï¼šå®ä¾‹åŒ–åˆçº¦å¯¹è±¡
   - `contract.getCurrentPacketId()`ï¼šè°ƒç”¨åªè¯»æ–¹æ³•éªŒè¯ ABI ä¸åŸºç¡€è¯»å–èƒ½åŠ›
4. éªŒè¯æˆåŠŸåï¼Œé¡µé¢ä¼šï¼š
   - å±•ç¤ºâ€œå½“å‰çº¢åŒ…IDâ€ç­‰ä¿¡æ¯
   - åœ¨æ—¥å¿—åŒºåŸŸè¾“å‡ºå¤šæ¡æˆåŠŸæ—¥å¿—
   - å°†åˆçº¦å®ä¾‹ä¸çŠ¶æ€å†™å…¥å…¨å±€ Storeï¼ˆè§£é”åˆ›å»º/é¢†å–/é€€æ¬¾/äº‹ä»¶æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼‰

### æ˜¯å¦æ¶ˆè€— Gasï¼Ÿ
- ä¸æ¶ˆè€—ã€‚ä¸Šè¿°æ­¥éª¤å‡ä¸ºåªè¯»è°ƒç”¨ï¼ˆ`eth_call`ï¼‰ï¼Œä¸ä¼šæ‰“åŒ…ä¸Šé“¾ï¼Œä¸äº§ç”Ÿäº¤æ˜“ä¸ Gas è´¹ç”¨ã€‚
- åªæœ‰ä¼šä¿®æ”¹é“¾ä¸ŠçŠ¶æ€çš„æ“ä½œï¼ˆå¦‚ `createRedPacket`ã€`claimRedPacket`ã€`refundRedPacket`ï¼‰æ‰ä¼šæ¶ˆè€— Gasã€‚

### å¸¸è§å¤±è´¥åŸå› ä¸æç¤º
- ç½‘ç»œä¸åŒ¹é…ï¼šæœªåˆ‡åˆ° `Sepolia` æµ‹è¯•ç½‘ â†’ è¯·åˆ‡æ¢ç½‘ç»œ
- åœ°å€æ— ä»£ç ï¼š`provider.getCode(address)` è¿”å› `0x` â†’ åœ°å€ä¸å­˜åœ¨åˆçº¦æˆ–æœªéƒ¨ç½²
- ABI ä¸åŒ¹é…ï¼š`getCurrentPacketId()` è¯»å–å¤±è´¥ â†’ æ£€æŸ¥å¯¼å…¥çš„ ABI æ˜¯å¦ä¸é“¾ä¸Šåˆçº¦ç‰ˆæœ¬ä¸€è‡´
- é’±åŒ…/Provider æœªå°±ç»ªï¼šè¯·å…ˆåˆå§‹åŒ– Provider å¹¶è¿æ¥é’±åŒ…

### éªŒè¯æµç¨‹å›¾ï¼ˆSVGï¼‰

<div align="center">
<svg width="860" height="360" viewBox="0 0 860 360" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#4b5563; stroke-width:2; rx:8; ry:8; }
      .title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; font-size:14px; fill:#111827; font-weight:600; }
      .text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; font-size:12px; fill:#374151; }
      .arrow { stroke:#6b7280; stroke-width:2; marker-end:url(#arrowHead); }
      .note { font-size:12px; fill:#10b981; font-weight:600; }
      .warn { font-size:12px; fill:#ef4444; font-weight:600; }
    </style>
    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#6b7280" />
    </marker>
  </defs>

  <!-- Step 1: è¾“å…¥åœ°å€ & ç‚¹å‡»éªŒè¯ -->
  <rect class="box" x="20" y="30" width="220" height="70" />
  <text class="title" x="30" y="55">1) è¾“å…¥åœ°å€å¹¶ç‚¹å‡»éªŒè¯</text>
  <text class="text" x="30" y="78">ç»„ä»¶: ContractVerification</text>
  <text class="text" x="30" y="96">æ ¡éªŒåœ°å€æ ¼å¼ (0x...)</text>

  <!-- Arrow 1 -->
  <line class="arrow" x1="240" y1="65" x2="300" y2="65" />

  <!-- Step 2: æ ¡éªŒç½‘ç»œ -->
  <rect class="box" x="300" y="30" width="220" height="70" />
  <text class="title" x="310" y="55">2) æ ¡éªŒç½‘ç»œ (Sepolia)</text>
  <text class="text" x="310" y="78">provider.getNetwork()</text>
  <text class="text" x="310" y="96">chainId === 11155111</text>

  <!-- Arrow 2 -->
  <line class="arrow" x1="520" y1="65" x2="580" y2="65" />

  <!-- Step 3: åœ°å€æœ‰æ— ä»£ç  -->
  <rect class="box" x="580" y="30" width="260" height="70" />
  <text class="title" x="590" y="55">3) è¯»å–åœ°å€å­—èŠ‚ç </text>
  <text class="text" x="590" y="78">provider.getCode(address)</text>
  <text class="text" x="590" y="96">è¿”å› '0x' ä»£è¡¨æ— åˆçº¦</text>

  <!-- Arrow 3 down -->
  <line class="arrow" x1="710" y1="100" x2="710" y2="140" />

  <!-- Step 4: å®ä¾‹åŒ–åˆçº¦ -->
  <rect class="box" x="580" y="140" width="260" height="70" />
  <text class="title" x="590" y="165">4) å®ä¾‹åŒ–åˆçº¦å¯¹è±¡</text>
  <text class="text" x="590" y="188">new ethers.Contract(address, ABI, provider)</text>

  <!-- Arrow 4 down -->
  <line class="arrow" x1="710" y1="210" x2="710" y2="250" />

  <!-- Step 5: è°ƒç”¨åªè¯»æ–¹æ³• -->
  <rect class="box" x="580" y="250" width="260" height="70" />
  <text class="title" x="590" y="275">5) åªè¯»è°ƒç”¨ (ä¸æ¶ˆè€—Gas)</text>
  <text class="text" x="590" y="298">contract.getCurrentPacketId()</text>
  <text class="text" x="590" y="316">éªŒè¯ ABI ä¸è¯»å–èƒ½åŠ›</text>

  <!-- Summary box -->
  <rect class="box" x="20" y="220" width="520" height="100" />
  <text class="title" x="30" y="245">ç»“æœ & çŠ¶æ€æ›´æ–°</text>
  <text class="text" x="30" y="268">- å†™å…¥å…¨å±€ Store: contract, currentPacketId, isVerified</text>
  <text class="text" x="30" y="288">- è¾“å‡ºæ—¥å¿—: æˆåŠŸ/é”™è¯¯ä¿¡æ¯</text>
  <text class="note" x="30" y="308">æç¤º: åªè¯»æµç¨‹ï¼Œä½¿ç”¨ eth_callï¼Œä¸æ¶ˆè€— Gas</text>

  <!-- Error branch from Step 2 (ç½‘ç»œé”™è¯¯) -->
  <line class="arrow" x1="410" y1="100" x2="410" y2="130" />
  <text class="warn" x="280" y="130">è‹¥ç½‘ç»œé Sepolia â†’ æ˜¾ç¤ºé”™è¯¯å¹¶ä¸­æ­¢</text>

  <!-- Error note for Step 3 (æ— ä»£ç ) -->
  <text class="warn" x="580" y="120">è‹¥è¿”å› '0x' â†’ åœ°å€æ— åˆçº¦/æœªéƒ¨ç½²</text>
</svg>
</div>
